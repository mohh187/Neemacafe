<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù…Ù†ÙŠÙˆ Ù†ÙŠÙ…Ø© | Neema Menu</title>
  <style>
/* Theme */
:root{
  --brand:#8b5e3c; --brand-2:#d4a373; --brand-dark:#70492d;
  --bg:#faf8f6; --card:#ffffff; --text:#1f1f1f; --muted:#6b6b6b; --border:#e9e6e3;
  --radius:16px; --shadow:0 10px 24px rgba(0,0,0,.08);
}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; background:var(--bg); color:var(--text);}
body.dark{ --bg:#0f0f0f; --card:#1a1a1a; --text:#f3f3f3; --muted:#b7b7b7; --border:#2a2a2a; }

/* Header */
header{position:sticky;top:0;z-index:20;background:rgba(255,255,255,.9);backdrop-filter:saturate(140%) blur(8px);border-bottom:1px solid var(--border)}
body.dark header{background:rgba(20,20,20,.82)}
.wrap{max-width:960px;margin-inline:auto;padding:12px 14px}
.top{display:flex;align-items:center;justify-content:space-between;gap:10px}
.brand{display:flex;align-items:center;gap:10px}
.brand img{width:48px;height:48px;border-radius:12px;border:1px solid var(--border);background:#fff;object-fit:contain}
.brand h1{font-size:18px;margin:0;line-height:1.2}

.actions{display:flex;gap:8px;align-items:center}
.btn{border:1px solid var(--border);background:var(--card);color:var(--text);padding:8px 10px;border-radius:10px;font-size:14px;cursor:pointer}
.btn.primary{background:var(--brand);border-color:transparent;color:#fff}
.btn.ghost{background:transparent}

/* Search */
.search{display:flex;gap:8px;margin:10px 0 8px}
.search input{flex:1;padding:12px 14px;border-radius:12px;border:1px solid var(--border);background:var(--card);color:var(--text);font-size:15px}

/* Sections */
main{max-width:960px;margin-inline:auto;padding:10px 14px 120px}
details{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;margin:10px 0}
summary{list-style:none;padding:14px 16px;cursor:pointer;display:flex;align-items:center;gap:10px;font-weight:700}
summary::marker{display:none}
.pill{display:inline-block;background:#efe6de;color:#5a3a22;border-radius:999px;padding:3px 8px;font-size:12px;margin-inline-start:6px}
body.dark .pill{background:#2b221b;color:#d9c3ad}

.grid{display:grid;grid-template-columns:1fr;gap:10px;padding:8px 12px 14px}
@media(min-width:520px){.grid{grid-template-columns:repeat(2,1fr)}}

.item{display:grid;grid-template-columns:72px 1fr;gap:10px;align-items:center;background:var(--card);border:1px solid var(--border);border-radius:14px;padding:10px;cursor:pointer}
.item:hover{box-shadow:0 6px 18px rgba(0,0,0,.06)}
.thumb{width:72px;height:72px;border-radius:12px;overflow:hidden;border:1px solid var(--border);background:#fafafa}
.thumb img{width:100%;height:100%;object-fit:contain;background:#fafafa}
.line{display:flex;align-items:center;gap:8px}
.name{font-weight:700}
.dots{flex:1 1 auto;border-bottom:1px dotted #c9c3bd;transform:translateY(-4px);opacity:.6}
.price{font-weight:800;color:var(--brand)}
.sub{font-size:12px;color:var(--muted)}
.cals{font-size:12px;color:#888;margin-top:2px}

/* SAR symbol (SVG mask) */
.price .sar {
  display:inline-block; width:1.05em; height:1em; margin-inline-start:.25em;
  background-color: currentColor;
  -webkit-mask: url("https://upload.wikimedia.org/wikipedia/commons/9/98/Saudi_Riyal_Symbol.svg") no-repeat center / contain;
  mask: url("https://upload.wikimedia.org/wikipedia/commons/9/98/Saudi_Riyal_Symbol.svg") no-repeat center / contain;
  vertical-align:-0.1em;
}
.price .sar-fallback{display:none;}
@supports not (mask: url("")) {
  .price .sar{display:none;}
  .price .sar-fallback{display:inline; font-weight:700; margin-inline-start:.25em;}
}

/* Bottom bar */
.bar{position:fixed;bottom:0;left:0;right:0;z-index:25;background:var(--card);border-top:1px solid var(--border);padding:10px}
.bar .inner{max-width:960px;margin-inline:auto;display:flex;gap:8px}
select, .bar .inner .btn{flex:1}

footer{color:var(--muted);text-align:center;margin:18px 0 120px}

/* -------- Product Modal -------- */
.modal, .cart{position:fixed;inset:0;display:none;z-index:300;align-items:flex-end;justify-content:center}
.modal .backdrop, .cart .backdrop{position:absolute;inset:0;background:rgba(0,0,0,.45)}
.sheet{
  position:relative;background:var(--card);color:var(--text);
  width:100%;max-width:560px;max-height:88vh;overflow:auto;
  border-top-left-radius:18px;border-top-right-radius:18px;
  box-shadow:var(--shadow);padding:14px
}
.sheet .row{display:flex;gap:12px}
.sheet .bigimg{width:120px;height:120px;border-radius:14px;border:1px solid var(--border);overflow:hidden;background:#fafafa;flex:0 0 auto}
.sheet .bigimg img{width:100%;height:100%;object-fit:contain}
.sheet h3{margin:6px 0 4px}
.sheet .desc{color:var(--muted);font-size:14px;line-height:1.6}
.qty{display:flex;align-items:center;gap:10px;margin-top:8px}
.qty button{width:32px;height:32px;border-radius:8px;border:1px solid var(--border);background:var(--card);cursor:pointer}
.sheet .line{margin-top:6px}
.sheet .actions{display:flex;gap:8px;margin-top:12px}
.sheet .actions .btn{flex:1}

/* Customization section */
.custom{margin-top:10px;border-top:1px dashed var(--border);padding-top:10px}
.custom h4{margin:0 0 8px;font-size:14px;color:var(--muted)}
.custom .opts{display:flex;flex-wrap:wrap;gap:8px}
.custom label{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--border);border-radius:10px;padding:6px 10px;background:var(--card);cursor:pointer;font-size:13px}
.custom .radios{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}

/* -------- Floating Cart Button -------- */
.fab{
  position:fixed; right:16px; bottom:86px; z-index:260;
  background:var(--brand); color:#fff; border:none; border-radius:999px;
  padding:12px 16px; box-shadow:0 10px 24px rgba(0,0,0,.18); cursor:pointer; display:flex; align-items:center; gap:8px
}
.fab .count{background:#fff;color:var(--brand);border-radius:999px;padding:2px 8px;font-weight:800}

/* -------- Cart Sheet -------- */
.cart .sheet h3{margin:0 0 10px}
.cart-item{display:grid;grid-template-columns:56px 1fr auto;gap:10px;align-items:center;border:1px solid var(--border);border-radius:12px;padding:8px;margin:6px 0}
.cart-item .thumb{width:56px;height:56px;border-radius:10px;overflow:hidden;border:1px solid var(--border)}
.cart-item .thumb img{width:100%;height:100%;object-fit:cover}
.cart-item .title{font-weight:700}
.cart-item .meta{font-size:12px;color:var(--muted)}
.cart-item .qty{justify-content:flex-end}
.cart .summary{display:flex;align-items:center;justify-content:space-between;margin-top:10px;font-weight:800}
.cart .actions{display:flex;gap:8px;margin-top:12px}
.empty{color:var(--muted);text-align:center;margin:12px 0}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="top">
        <div class="brand">
          <img src="https://i.postimg.cc/g0g9RwM0/Untitled-design-9.png" alt="Neema Menu">
          <div>
            <h1 id="title">Ù…Ù†ÙŠÙˆ Ù†ÙŠÙ…Ø©</h1>
            <span class="pill" id="tagline">Ù…Ø°Ø§Ù‚ ÙŠÙ†Ø¨Øª Ù…Ù† Ø§Ù„Ø¬Ø°ÙˆØ±</span>
          </div>
        </div>
        <div class="actions">
          <button class="btn" id="langBtn">English</button>
          <button class="btn" id="modeBtn">ğŸŒ™</button>
        </div>
      </div>
      <div class="search">
        <input id="search" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„ØµÙ†Ùâ€¦ (Ù…Ø«Ø§Ù„: Ù„Ø§ØªÙŠÙ‡ØŒ Ù…ÙˆÙ‡ÙŠØªÙˆ)">
      </div>
    </div>
  </header>

  <main>
    <details open>
      <summary>ğŸ”¥ <span data-i18n="hot_drinks">Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª Ø§Ù„Ø³Ø§Ø®Ù†Ø©</span></summary>
      <div class="grid" id="hot-coffee"></div>
      <div class="grid" id="hot-tea"></div>
    </details>

    <details>
      <summary>â„ï¸ <span data-i18n="cold_drinks">Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª Ø§Ù„Ø¨Ø§Ø±Ø¯Ø©</span></summary>
      <div class="grid" id="cold-coffee"></div>
      <div class="grid" id="cold-mojito"></div>
      <div class="grid" id="cold-other"></div>
    </details>

    <details>
      <summary>ğŸ° <span data-i18n="dessert">Ø§Ù„Ø­Ù„Ø§</span></summary>
      <div class="grid" id="dessert-cake"></div>
      <div class="grid" id="dessert-side"></div>
    </details>

    <footer>
      <div id="foot">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© - Ù†ÙŠÙ…Ø© ÙƒØ§ÙÙŠÙ‡ Â©</div>
    </footer>
  </main>

  <!-- Floating Cart Button -->
  <button class="fab" id="cartFab">ğŸ›’ <span data-i18n="cart">Ø§Ù„Ø³Ù„Ø©</span> <span class="count" id="cartCount">0</span></button>

  <!-- Product Modal -->
  <div class="modal" id="productModal" aria-hidden="true">
    <div class="backdrop" onclick="closeProduct()"></div>
    <div class="sheet">
      <div class="row">
        <div class="bigimg"><img id="pImg" alt=""></div>
        <div style="flex:1">
          <h3 id="pName">Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</h3>
          <div class="line">
            <span class="price" id="pPrice">0
              <span class="sar" aria-label="Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ"></span>
              <span class="sar-fallback">Ø±ÙŠØ§Ù„</span>
            </span>
            <span class="cals" id="pCal">0 Ø³Ø¹Ø±Ø© Ø­Ø±Ø§Ø±ÙŠØ©</span>
          </div>
        </div>
      </div>

      <p class="desc" id="pDesc"></p>

      <!-- Customization -->
      <div class="custom">
        <h4 id="customTitle">Ø§Ù„ØªØ®ØµÙŠØµ</h4>

        <!-- Sugar options -->
        <div class="radios" id="sugarGroup">
          <label><input type="radio" name="sugar" value="external" checked> <span id="lblSugarExternal">Ø³ÙƒØ± Ø®Ø§Ø±Ø¬ÙŠ</span></label>
          <label><input type="radio" name="sugar" value="none"> <span id="lblSugarNone">Ø¨Ø¯ÙˆÙ† Ø³ÙƒØ±</span></label>
          <label><input type="radio" name="sugar" value="less"> <span id="lblSugarLess">Ø³ÙƒØ± Ù‚Ù„ÙŠÙ„</span></label>
          <label><input type="radio" name="sugar" value="normal"> <span id="lblSugarNormal">Ø³ÙƒØ± Ø¹Ø§Ø¯ÙŠ</span></label>
        </div>

        <!-- Water temperature (water only) -->
        <div class="radios" id="waterTempGroup" style="display:none">
          <label><input type="radio" name="waterTemp" value="cold" checked> <span id="lblWaterCold">Ø¨Ø§Ø±Ø¯ (Ù…Ù† Ø§Ù„Ø«Ù„Ø§Ø¬Ø©)</span></label>
          <label><input type="radio" name="waterTemp" value="room"> <span id="lblWaterRoom">ØºÙŠØ± Ù…Ø¨Ø±Ø¯ (Ø¯Ø±Ø¬Ø© Ø§Ù„ØºØ±ÙØ©)</span></label>
        </div>

        <!-- Base opts -->
        <div class="opts" id="customBase" style="margin-top:6px">
          <label id="wrapLessIce"><input type="checkbox" id="optLessIce"> <span id="lblLessIce">Ø«Ù„Ø¬ Ø£Ù‚Ù„</span></label>
        </div>

        <!-- Jabana-only -->
        <div class="opts" id="customJabana" style="display:none">
          <label><input type="checkbox" id="optGinger"> <span id="lblGinger">Ø²Ù†Ø¬Ø¨ÙŠÙ„</span></label>
          <label><input type="checkbox" id="optCardamom"> <span id="lblCardamom">Ù‡Ø¨Ù‡Ø§Ù†</span></label>
        </div>

        <div class="radios" id="strengthGroup" style="display:none">
          <label><input type="radio" name="strength" value="heavy"> <span id="lblHeavy">Ø«Ù‚ÙŠÙ„Ø©</span></label>
          <label><input type="radio" name="strength" value="light"> <span id="lblLight">Ø®ÙÙŠÙØ©</span></label>
          <label><input type="radio" name="strength" value="balanced" checked> <span id="lblBalanced">Ù…ÙˆØ²ÙˆÙ†Ø©</span></label>
        </div>
      </div>

      <div class="qty">
        <button onclick="decQty()">âˆ’</button>
        <span id="pQty" style="min-width:24px;text-align:center">1</span>
        <button onclick="incQty()">+</button>
      </div>
      <div class="actions">
        <button class="btn" onclick="closeProduct()" id="backBtn">Ø±Ø¬ÙˆØ¹</button>
        <button class="btn primary" onclick="addCurrentToCart()" id="addBtn">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©</button>
      </div>
    </div>
  </div>

  <!-- Cart Sheet -->
  <div class="cart" id="cartSheet" aria-hidden="true">
    <div class="backdrop" onclick="closeCart()"></div>
    <div class="sheet">
      <h3><span data-i18n="your_cart">Ø³Ù„Ø© Ø·Ù„Ø¨Ø§ØªÙƒ</span></h3>
      <div id="cartItems"></div>
      <div class="summary">
        <div><span data-i18n="total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>:</div>
        <div class="price" id="cartTotal">0 <span class="sar"></span><span class="sar-fallback">Ø±ÙŠØ§Ù„</span></div>
      </div>
      <div style="margin-top:10px;display:flex;gap:8px;align-items:center">
        <label for="tableCart" style="color:var(--muted)"><span data-i18n="table">Ø·Ø§ÙˆÙ„Ø©</span></label>
        <select id="tableCart" style="flex:1;border:1px solid var(--border);background:var(--card);color:var(--text);padding:8px;border-radius:10px"></select>
      </div>
      <div class="actions">
        <button class="btn" onclick="clearCart()"><span data-i18n="clear">ØªÙØ±ÙŠØº</span></button>
        <button class="btn primary" onclick="sendOrder()"><span data-i18n="send_order">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</span> ğŸš€</button>
      </div>
      <div id="emptyText" class="empty" style="display:none"><span data-i18n="empty">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</span></div>
    </div>
  </div>

  <div class="bar">
    <div class="inner">
      <select id="table"></select>
      <button class="btn primary" id="callBtn">ğŸ”” <span data-i18n="call_waiter">Ø·Ù„Ø¨ Ø§Ù„Ù†Ø§Ø¯Ù„</span></button>
    </div>
  </div>

  <script>
/* ===== Telegram (Ø§Ø®ØªØ¨Ø§Ø±) ===== */
const TELEGRAM_BOT_TOKEN = '8234122453:AAGmkEFETh1yuXzgDHChoTu0YFuD0BeVK8c';
const TELEGRAM_CHAT_ID_NEW = '5828433542';

/* ===== Lang & Strings ===== */
let lang = localStorage.getItem('nima.lang') || 'ar';

const STRINGS = {
  ar: {
    title:'Ù…Ù†ÙŠÙˆ Ù†ÙŠÙ…Ø©', tagline:'Ù…Ø°Ø§Ù‚ ÙŠÙ†Ø¨Øª Ù…Ù† Ø§Ù„Ø¬Ø°ÙˆØ±', search:'Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„ØµÙ†Ùâ€¦ (Ù…Ø«Ø§Ù„: Ù„Ø§ØªÙŠÙ‡ØŒ Ù…ÙˆÙ‡ÙŠØªÙˆ)',
    hot_drinks:'Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª Ø§Ù„Ø³Ø§Ø®Ù†Ø©', cold_drinks:'Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª Ø§Ù„Ø¨Ø§Ø±Ø¯Ø©', dessert:'Ø§Ù„Ø­Ù„Ø§',
    call_waiter:'Ø·Ù„Ø¨ Ø§Ù„Ù†Ø§Ø¯Ù„', table:'Ø·Ø§ÙˆÙ„Ø©', footer:'Â© ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© - Ù†ÙŠÙ…Ø© ÙƒØ§ÙÙŠÙ‡',
    cart:'Ø§Ù„Ø³Ù„Ø©', your_cart:'Ø³Ù„Ø© Ø·Ù„Ø¨Ø§ØªÙƒ', total:'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ', send_order:'Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨', clear:'ØªÙØ±ÙŠØº', empty:'Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©',
    added:'ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©', qty:'Ø§Ù„ÙƒÙ…ÙŠØ©', add_to_cart:'Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©',
    kcal:'Ø³Ø¹Ø±Ø© Ø­Ø±Ø§Ø±ÙŠØ©', sar_label:'Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ', back:'Ø±Ø¬ÙˆØ¹',
    waiter_toast:'ğŸ”” Ø³ÙˆÙ ÙŠØ£ØªÙŠ Ø¥Ù„ÙŠÙƒ Ø§Ù„Ù†Ø§Ø¯Ù„ Ù„Ø®Ø¯Ù…ØªÙƒ ÙÙˆØ±Ø§Ù‹!',
    customize:'Ø§Ù„ØªØ®ØµÙŠØµ', less_ice:'Ø«Ù„Ø¬ Ø£Ù‚Ù„',
    ginger:'Ø²Ù†Ø¬Ø¨ÙŠÙ„', cardamom:'Ù‡Ø¨Ù‡Ø§Ù†',
    strength:'Ø§Ù„Ù‚ÙˆØ©', heavy:'Ø«Ù‚ÙŠÙ„Ø©', light:'Ø®ÙÙŠÙØ©', balanced:'Ù…ÙˆØ²ÙˆÙ†Ø©',
    sugar_external:'Ø³ÙƒØ± Ø®Ø§Ø±Ø¬ÙŠ', sugar_none:'Ø¨Ø¯ÙˆÙ† Ø³ÙƒØ±', sugar_less:'Ø³ÙƒØ± Ù‚Ù„ÙŠÙ„', sugar_normal:'Ø³ÙƒØ± Ø¹Ø§Ø¯ÙŠ',
    water_cold:'Ø¨Ø§Ø±Ø¯ (Ù…Ù† Ø§Ù„Ø«Ù„Ø§Ø¬Ø©)', water_room:'ØºÙŠØ± Ù…Ø¨Ø±Ø¯ (Ø¯Ø±Ø¬Ø© Ø§Ù„ØºØ±ÙØ©)'
  },
  en: {
    title:'Neema Menu', tagline:'A taste that grows from the roots', search:'Search itemâ€¦ (e.g., Latte, Mojito)',
    hot_drinks:'Hot Drinks', cold_drinks:'Cold Drinks', dessert:'Dessert',
    call_waiter:'Call Waiter', table:'Table', footer:'Â© Neema Cafe â€” All rights reserved',
    cart:'Cart', your_cart:'Your Cart', total:'Total', send_order:'Send Order', clear:'Clear', empty:'Cart is empty',
    added:'Item added to cart', qty:'Qty', add_to_cart:'Add to Cart',
    kcal:'kcal', sar_label:'Saudi Riyal', back:'Back',
    waiter_toast:'ğŸ”” A waiter is on the way!',
    customize:'Customize', less_ice:'Less ice',
    ginger:'Ginger', cardamom:'Cardamom',
    strength:'Strength', heavy:'Strong', light:'Light', balanced:'Balanced',
    sugar_external:'Sugar on the side', sugar_none:'No sugar', sugar_less:'Less sugar', sugar_normal:'Regular sugar',
    water_cold:'Cold (chilled)', water_room:'Room temperature'
  }
};

const IMG_DEFAULT = 'https://i.postimg.cc/Y0GT5M1f/image.png';

/* ===== Auto description helper ===== */
function autoDesc(it){
  const n = (it.en || it.ar || '').toLowerCase();
  const D = {
    latte: { ar:'Ø­Ù„ÙŠØ¨ Ù…Ø®Ù…Ù‘Ø± Ù…Ø¹ Ø¥Ø³Ø¨Ø±Ø³Ùˆ Ø¨Ù†ÙƒÙ‡Ø© Ù†Ø§Ø¹Ù…Ø© ÙˆÙ…ØªÙˆØ§Ø²Ù†Ø©.', en:'Silky steamed milk with espresso, smooth and balanced.' },
    cappuccino: { ar:'Ø±ØºÙˆØ© ØºÙ†ÙŠØ© ÙˆØ¥Ø³Ø¨Ø±Ø³Ùˆ Ø¨Ø·Ø§Ø¨Ø¹ ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ.', en:'Classic espresso topped with rich foam.' },
    espresso: { ar:'Ø¬Ø±Ø¹Ø© Ù…Ø±ÙƒØ²Ø© Ù…Ù† Ø§Ù„Ù‚Ù‡ÙˆØ© Ø¨Ø·Ø¹Ù… Ù‚ÙˆÙŠ.', en:'A concentrated shot of bold espresso.' },
    americano: { ar:'Ø¥Ø³Ø¨Ø±Ø³Ùˆ Ù…Ø¹ Ù…Ø§Ø¡ Ø³Ø§Ø®Ù† Ø¨Ø·Ø§Ø¨Ø¹ Ø®ÙÙŠÙ.', en:'Espresso topped with hot waterâ€”clean and light.' },
    mocha: { ar:'Ù‚Ù‡ÙˆØ© Ø¨Ø§Ù„Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ© ÙˆÙƒØ±ÙŠÙ…Ø© Ù…Ø®Ù…Ù„ÙŠØ©.', en:'Chocolate-kissed coffee with a velvety finish.' },
    spanish: { ar:'Ø­Ù„Ø§ÙˆØ© Ù…ØªÙˆØ§Ø²Ù†Ø© Ù…Ø¹ Ø­Ù„ÙŠØ¨ Ù…ÙƒØ«Ù‘Ù.', en:'Balanced sweetness with condensed milk.' },
    v60: { ar:'Ø§Ø³ØªØ®Ù„Ø§Øµ ØªØ±Ø´ÙŠØ­ ÙŠØ¨Ø±Ø² Ù†ÙƒÙ‡Ø§Øª Ø§Ù„Ø¨Ù†Ù‘.', en:'Filtered extraction highlighting bean nuances.' },
    turkish: { ar:'Ù‚Ù‡ÙˆØ© Ù…Ø·Ø­ÙˆÙ†Ø© Ù†Ø§Ø¹Ù…Ø© Ø¨Ø±ØºÙˆØ© ØªÙ‚Ù„ÙŠØ¯ÙŠØ©.', en:'Finely ground, traditionally foamed coffee.' },
    flat: { ar:'Ù…Ù„Ù…Ø³ Ù…Ø®Ù…Ù„ÙŠ ÙˆÙ†ÙƒÙ‡Ø© Ù…Ø±ÙƒÙ‘Ø²Ø©.', en:'Velvety milk with a pronounced espresso body.' },
    macchiato: { ar:'Ø¥Ø³Ø¨Ø±Ø³Ùˆ Ù…Ø¹ Ù„Ù…Ø³Ø© Ø­Ù„ÙŠØ¨.', en:'Espresso stained with a touch of milk.' },
    cortado: { ar:'ØªÙˆØ§Ø²Ù† Ø¨ÙŠÙ† Ø§Ù„Ø­Ù„ÙŠØ¨ ÙˆØ§Ù„Ø¥Ø³Ø¨Ø±Ø³Ùˆ.', en:'A balance of steamed milk and espresso.' },
    matcha: { ar:'Ù…Ø§ØªØ´Ø§ ÙƒØ±ÙŠÙ…ÙŠ Ø¨Ù†ÙƒÙ‡Ø© Ø¹Ø´Ø¨ÙŠØ©.', en:'Creamy matcha with grassy notes.' },
    chocolate: { ar:'ÙƒØ§ÙƒØ§Ùˆ Ø³Ø§Ø®Ù† ØºÙ†ÙŠ.', en:'Rich hot chocolate.' },
    mojito: { ar:'Ø§Ù†ØªØ¹Ø§Ø´ Ù†Ø¹Ù†Ø¹ÙŠ Ø¨Ø­Ù…ÙˆØ¶Ø© Ù„ÙŠÙ…ÙˆÙ†.', en:'Minty refreshment with a lime twist.' },
    hibiscus: { ar:'ÙƒØ±ÙƒØ¯ÙŠÙ‡ Ø²Ù‡Ø±ÙŠ Ù…Ù†Ø¹Ø´.', en:'Floral, tart hibiscus.' },
    smoothie: { ar:'Ø³Ù…ÙˆØ°ÙŠ Ø¨Ø§Ø±Ø¯ ÙˆÙ…Ù†Ø¹Ø´.', en:'A cold, refreshing smoothie.' },
    pistachio: { ar:'Ù„Ø§ØªÙŠÙ‡ ÙØ³ØªÙ‚ ÙƒØ±ÙŠÙ…ÙŠ.', en:'Creamy pistachio latte.' },
    cake: { ar:'Ø´Ø±ÙŠØ­Ø© Ø­Ù„ÙˆÙ‰ Ø·Ø§Ø²Ø¬Ø©.', en:'Fresh sweet slice.' },
    luqaimat: { ar:'Ù„Ù‚ÙŠÙ…Ø§Øª Ø°Ù‡Ø¨ÙŠØ© Ù…Ù‚Ø±Ù…Ø´Ø©.', en:'Golden, crisp bites.' },
    water: { ar:'Ù…Ø§Ø¡ Ù†Ù‚ÙŠ Ø¨Ø§Ø±Ø¯.', en:'Chilled, pure water.' }
  };
  const pick = Object.keys(D).find(k => n.includes(k));
  return pick ? (lang==='ar' ? D[pick].ar : D[pick].en) :
    (lang==='ar' ? 'Ø·Ø¹Ù… Ù…ØªÙˆØ§Ø²Ù† ÙˆÙ†ÙƒÙ‡Ø© Ù…Ø­Ø¶Ù‘Ø±Ø© Ø¨Ø¹Ù†Ø§ÙŠØ©.' : 'Balanced taste, crafted with care.');
}

/* ===== Data ===== */
const data = {
  hot: {
    coffee: [
      {ar:'Ú¤ÙŠ 60', en:'V60', price:13, cal:5, img:IMG_DEFAULT},
      {ar:'Ù‚Ù‡ÙˆØ© Ø§Ù„ÙŠÙˆÙ…', en:'Coffee of the Day', price:8, cal:5, img:IMG_DEFAULT},
      {ar:'Ø§Ù…Ø±ÙŠÙƒØ§Ù†Ùˆ (ØµØºÙŠØ±)', en:'Americano (Small)', price:6, cal:5, img:IMG_DEFAULT},
      {ar:'Ø§Ù…Ø±ÙŠÙƒØ§Ù†Ùˆ (ÙˆØ³Ø·)', en:'Americano (Medium)', price:8, cal:10, img:IMG_DEFAULT},
      {ar:'Ø§Ø³Ø¨Ø±ÙŠØ³Ùˆ', en:'Espresso', price:6, cal:5, img:IMG_DEFAULT},
      {ar:'Ù‚Ù‡ÙˆØ© ØªØ±ÙƒÙŠ', en:'Turkish Coffee', price:8, cal:15, img:IMG_DEFAULT},
      {ar:'Ø¬Ø¨Ù†Ø© (Ù‚Ù‡ÙˆØ© Ø³ÙˆØ¯Ø§Ù†ÙŠØ©)', en:'Jabana (Sudanese Coffee)', price:6, cal:10, img:IMG_DEFAULT},
      {ar:'Ø¬Ø¨Ù†Ø© ÙÙŠ Ø¬Ø¨Ù†Ø© (ÙˆØ³Ø·)', en:'Jabana in Jabana (Medium)', price:16, cal:20, img:IMG_DEFAULT},
      {ar:'Ø³Ø¨Ø§Ù†Ø´', en:'Spanish Latte (Hot)', price:12, cal:180, img:IMG_DEFAULT},
      {ar:'ÙˆØ§ÙŠØª Ù…ÙˆÙƒØ§', en:'White Mocha (Hot)', price:18, cal:280, img:IMG_DEFAULT},
      {ar:'Ù„Ø§ØªÙŠÙ‡', en:'Latte (Hot)', price:12, cal:190, img:IMG_DEFAULT},
      {ar:'ÙƒØ§Ø¨ØªØ´ÙŠÙ†Ùˆ', en:'Cappuccino', price:12, cal:120, img:IMG_DEFAULT},
      {ar:'ÙƒÙˆØ±ØªØ§Ø¯Ùˆ', en:'Cortado', price:7, cal:90, img:IMG_DEFAULT},
      {ar:'ÙÙ„Ø§Øª ÙˆØ§ÙŠØª', en:'Flat White', price:12, cal:150, img:IMG_DEFAULT},
      {ar:'Ù…ÙŠÙƒØ§ØªÙˆ', en:'Macchiato', price:7, cal:25, img:IMG_DEFAULT},
      {ar:'Ù‚Ù‡ÙˆØ© ÙØ±Ù†Ø³ÙŠ', en:'French Coffee', price:9, cal:120, img:IMG_DEFAULT}
    ],
    tea: [
      {ar:'Ø´Ø§ÙŠ', en:'Tea', price:3, cal:2, img:IMG_DEFAULT},
      {ar:'Ø´Ø§ÙŠ Ù…Ù‚Ù†Ù†', en:'Strong Tea', price:6, cal:2, img:IMG_DEFAULT},
      {ar:'Ø´Ø§ÙŠ Ø­Ù„ÙŠØ¨', en:'Milk Tea', price:6, cal:140, img:IMG_DEFAULT},
      {ar:'Ù‡ÙˆØª Ø´ÙˆÙƒÙ„Øª', en:'Hot Chocolate', price:13, cal:300, img:IMG_DEFAULT},
      {ar:'Ù…Ø§ØªØ´Ø§', en:'Matcha (Hot)', price:16, cal:180, img:IMG_DEFAULT}
    ]
  },
  cold: {
    coffee: [
      {ar:'Ú¤ÙŠ 60', en:'V60 (Iced)', price:13, cal:5, img:IMG_DEFAULT},
      {ar:'Ù‚Ù‡ÙˆØ© Ø§Ù„ÙŠÙˆÙ…', en:'Coffee of the Day (Iced)', price:8, cal:5, img:IMG_DEFAULT},
      {ar:'Ø§Ù…Ø±ÙŠÙƒØ§Ù†Ùˆ', en:'Iced Americano', price:9, cal:5, img:IMG_DEFAULT},
      {ar:'Ø³Ø¨Ø§Ù†Ø´', en:'Spanish Latte (Iced)', price:17, cal:180, img:IMG_DEFAULT},
      {ar:'Ù„Ø§ØªÙŠÙ‡', en:'Iced Latte', price:12, cal:190, img:IMG_DEFAULT},
      {ar:'Ø³Ø¨Ø§Ù†Ø´ Ù„Ø§ØªÙŠÙ‡', en:'Spanish Latte', price:14, cal:220, img:IMG_DEFAULT},
      {ar:'ÙˆØ§ÙŠØª Ù…ÙˆÙƒØ§', en:'White Mocha (Iced)', price:18, cal:300, img:IMG_DEFAULT},
      {ar:'Ù†ÙŠÙ…Ø© Ø´ÙŠÙƒÙ†', en:'Neema Chicken (Cold Drink)', price:19, cal:220, img:IMG_DEFAULT},
      {ar:'Ø¨Ø³ØªØ§Ø´ÙŠÙˆ Ù„Ø§ØªÙŠÙ‡', en:'Pistachio Latte (Iced)', price:18, cal:280, img:IMG_DEFAULT}
    ],
    mojito: [
      {ar:'Ù…ÙˆÙ‡ÙŠØªÙˆ', en:'Mojito', price:17, cal:120, img:IMG_DEFAULT},
      {ar:'Ù…ÙˆÙ‡ÙŠØªÙˆ Ù…ÙƒØ³', en:'Mojito Mix', price:18, cal:140, img:IMG_DEFAULT},
      {ar:'Ù…ÙˆÙ‡ÙŠØªÙˆ Ø¨Ù„Ùˆ Ø¨ÙŠØ±ÙŠ/ÙƒÙˆØ¯ Ø±Ø¯', en:'Blueberry Mojito / Code Red', price:17, cal:170, img:IMG_DEFAULT},
      {ar:'Ù…ÙˆÙ‡ÙŠØªÙˆ Ø¨Ù„Ùˆ Ø¨ÙŠØ±ÙŠ/Ø³ÙÙ† Ø¢Ø¨', en:'Blueberry Mojito / 7up', price:15, cal:150, img:IMG_DEFAULT},
      {ar:'Ù…ÙˆÙ‡ÙŠØªÙˆ ÙØ±Ø§ÙˆÙ„Ø©/ÙƒÙˆØ¯ Ø±Ø¯', en:'Strawberry Mojito / Code Red', price:17, cal:170, img:IMG_DEFAULT},
      {ar:'Ù…ÙˆÙ‡ÙŠØªÙˆ ÙØ±Ø§ÙˆÙ„Ø©/Ø³ÙÙ† Ø¢Ø¨', en:'Strawberry Mojito / 7up', price:15, cal:150, img:IMG_DEFAULT},
      {ar:'Ù…ÙˆÙ‡ÙŠØªÙˆ Ø¨Ø·ÙŠØ®/ÙƒÙˆØ¯ Ø±Ø¯', en:'Watermelon Mojito / Code Red', price:17, cal:160, img:IMG_DEFAULT},
      {ar:'Ù…ÙˆÙ‡ÙŠØªÙˆ Ø¨Ø·ÙŠØ®/Ø³ÙÙ† Ø¢Ø¨', en:'Watermelon Mojito / 7up', price:15, cal:140, img:IMG_DEFAULT},
      {ar:'Ù…ÙˆÙ‡ÙŠØªÙˆ Ø¨Ø§Ø´Ù† ÙØ±ÙˆØª/ÙƒÙˆØ¯ Ø±Ø¯', en:'Passion Fruit Mojito / Code Red', price:17, cal:170, img:IMG_DEFAULT},
      {ar:'Ù…ÙˆÙ‡ÙŠØªÙˆ Ø¨Ø§Ø´Ù† ÙØ±ÙˆØª/Ø³ÙÙ† Ø¢Ø¨', en:'Passion Fruit Mojito / 7up', price:15, cal:150, img:IMG_DEFAULT}
    ],
    other:[
      {ar:'ÙƒØ±ÙƒØ¯ÙŠÙ‡', en:'Hibiscus', price:8, cal:50, img:IMG_DEFAULT},
      {ar:'Ø³Ù…ÙˆØ°ÙŠ ÙƒØ±ÙƒØ¯ÙŠ', en:'Hibiscus Smoothie', price:17, cal:180, img:https://ibb.co/7JwyH9pD},
      {ar:'Ù…Ø§Ø¡', en:'Water', price:1, cal:0, img:IMG_DEFAULT}
    ]
  },
  dessert: {
    cake: [
      {ar:'Ù†ÙŠÙ…Ø© ÙƒÙŠÙƒ', en:'Neema Cake', price:18, cal:420, img:IMG_DEFAULT},
      {ar:'Ù…ÙˆÙ†ØªÙŠ ÙƒÙŠÙƒ', en:'Monte Cake', price:17, cal:430, img:IMG_DEFAULT},
      {ar:'Ù…ÙˆÙ„ØªÙ† Ø¯Ø§Ø±Ùƒ ØªØ´ÙˆÙƒÙ„ÙŠØª', en:'Molten Dark Chocolate', price:17, cal:450, img:IMG_DEFAULT}
    ],
    side: [
      {ar:'ÙŠÙ†Ø³ÙˆÙ†', en:'Anise Tea', price:4, cal:5, img:IMG_DEFAULT},
      {ar:'Ø¨Ø³ÙƒÙˆÙŠØª Ø´Ø§ÙŠ ÙƒØ¨ÙŠØ±', en:'Tea Biscuit (Large)', price:8, cal:200, img:IMG_DEFAULT},
      {ar:'Ø¨Ø³ÙƒÙˆÙŠØª Ø´Ø§ÙŠ ØµØºÙŠØ±', en:'Tea Biscuit (Small)', price:3, cal:100, img:IMG_DEFAULT},
      {ar:'Ù„Ù‚ÙŠÙ…Ø§Øª', en:'Luqaimat', price:13, cal:320, img:IMG_DEFAULT}
    ]
  }
};

/* ===== State ===== */
let cart = JSON.parse(localStorage.getItem('nima.cart') || '[]');
function saveCart(){ localStorage.setItem('nima.cart', JSON.stringify(cart)); }
function cartCount(){ return cart.reduce((s,i)=>s+i.qty,0); }
function cartTotal(){ return cart.reduce((s,i)=>s+i.qty*i.price,0); }
function updateCartBadge(){ document.getElementById('cartCount').textContent = cartCount(); }

/* ===== Helpers ===== */
const $ = (s)=>document.querySelector(s);
const REG = []; // registry for click-safe products (no inline JSON)
function register(item, cat){ const id = REG.push({item,cat})-1; return id; }

function priceHTML(p){
  return `${p} <span class="sar" aria-label="${STRINGS[lang].sar_label}"></span><span class="sar-fallback">${lang==='ar'?'Ø±ÙŠØ§Ù„':'SAR'}</span>`;
}

function makeItemEl(it, cat){
  const el = document.createElement('div');
  el.className = 'item';
  const name = (lang==='ar'?it.ar:it.en);
  const id = register(it, cat);
  el.innerHTML = `
    <div class="thumb"><img src="${it.img||IMG_DEFAULT}" alt="${name}"/></div>
    <div>
      <div class="line">
        <span class="name">${name}</span>
        <span class="dots"></span>
        <span class="price">${priceHTML(it.price)}</span>
      </div>
      <div class="cals">${it.cal} ${STRINGS[lang].kcal}</div>
      <div class="sub">${it['desc_'+lang] || autoDesc(it)}</div>
    </div>`;
  el.addEventListener('click', ()=>{ const rec=REG[id]; openProduct(rec.item, rec.cat); });
  return el;
}

function mount(containerId, arr, cat){
  const root = document.getElementById(containerId); root.innerHTML='';
  arr.forEach(it=> root.appendChild(makeItemEl(it, cat)));
}

function renderAll(){
  // strings
  $('#title').textContent = STRINGS[lang].title;
  $('#tagline').textContent = STRINGS[lang].tagline;
  $('#search').placeholder = STRINGS[lang].search;
  document.querySelectorAll('[data-i18n="hot_drinks"]').forEach(e=> e.textContent = STRINGS[lang].hot_drinks);
  document.querySelectorAll('[data-i18n="cold_drinks"]').forEach(e=> e.textContent = STRINGS[lang].cold_drinks);
  document.querySelectorAll('[data-i18n="dessert"]').forEach(e=> e.textContent = STRINGS[lang].dessert);
  document.querySelectorAll('[data-i18n="call_waiter"]').forEach(e=> e.textContent = STRINGS[lang].call_waiter);
  document.querySelectorAll('[data-i18n="cart"]').forEach(e=> e.textContent = STRINGS[lang].cart);
  document.querySelectorAll('[data-i18n="your_cart"]').forEach(e=> e.textContent = STRINGS[lang].your_cart);
  document.querySelectorAll('[data-i18n="total"]').forEach(e=> e.textContent = STRINGS[lang].total);
  document.querySelectorAll('[data-i18n="send_order"]').forEach(e=> e.textContent = STRINGS[lang].send_order);
  document.querySelectorAll('[data-i18n="clear"]').forEach(e=> e.textContent = STRINGS[lang].clear);
  document.querySelectorAll('[data-i18n="empty"]').forEach(e=> e.textContent = STRINGS[lang].empty);

  // dir/lang
  document.documentElement.lang = (lang==='ar'?'ar':'en');
  document.documentElement.dir = (lang==='ar'?'rtl':'ltr');

  // items
  mount('hot-coffee', data.hot.coffee, 'hot');
  mount('hot-tea', data.hot.tea, 'hot');
  mount('cold-coffee', data.cold.coffee, 'cold');
  mount('cold-mojito', data.cold.mojito, 'cold');
  mount('cold-other', data.cold.other, 'cold');
  mount('dessert-cake', data.dessert.cake, 'dessert');
  mount('dessert-side', data.dessert.side, 'dessert');

  fillTables();
  fillTablesCart();
  updateCartBadge();
  updateCustomizationLabels();
}

/* ===== Search ===== */
const search = $('#search');
search.addEventListener('input', ()=>{
  const q = search.value.trim().toLowerCase();
  const f = (arr)=>arr.filter(x=> ((x.ar||'')+(x.en||'')).toLowerCase().includes(q));
  mount('hot-coffee', f(data.hot.coffee), 'hot');
  mount('hot-tea', f(data.hot.tea), 'hot');
  mount('cold-coffee', f(data.cold.coffee), 'cold');
  mount('cold-mojito', f(data.cold.mojito), 'cold');
  mount('cold-other', f(data.cold.other), 'cold');
  mount('dessert-cake', f(data.dessert.cake), 'dessert');
  mount('dessert-side', f(data.dessert.side), 'dessert');
});

/* ===== Mode toggle ===== */
const modeBtn = $('#modeBtn');
const savedMode = localStorage.getItem('nima.mode');
if(savedMode){ if(savedMode==='dark') document.body.classList.add('dark'); }
else if(window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches){ document.body.classList.add('dark'); }
modeBtn.textContent = document.body.classList.contains('dark') ? 'â˜€ï¸' : 'ğŸŒ™';
modeBtn.onclick = ()=>{
  document.body.classList.toggle('dark');
  localStorage.setItem('nima.mode', document.body.classList.contains('dark')?'dark':'light');
  modeBtn.textContent = document.body.classList.contains('dark') ? 'â˜€ï¸' : 'ğŸŒ™';
};

/* ===== Language toggle ===== */
const langBtn = $('#langBtn');
function updateLangBtn(){ langBtn.textContent = (lang==='ar') ? 'English' : 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©'; }
langBtn.onclick = ()=>{
  lang = (lang==='ar') ? 'en' : 'ar';
  localStorage.setItem('nima.lang', lang);
  renderAll(); updateLangBtn();
};

/* ===== Tables ===== */
const tableSelect = $('#table');
function fillTables(){
  tableSelect.innerHTML='';
  for(let i=1;i<=15;i++){
    const o=document.createElement('option');
    o.value=i; o.textContent = `${STRINGS[lang].table} ${i}`; tableSelect.appendChild(o);
  }
  const saved = localStorage.getItem('nima.table');
  if(saved) tableSelect.value=saved;
  tableSelect.onchange = ()=> localStorage.setItem('nima.table', tableSelect.value);
}
function fillTablesCart(){
  const sel = $('#tableCart');
  sel.innerHTML='';
  for(let i=1;i<=15;i++){
    const o=document.createElement('option');
    o.value=i; o.textContent = `${STRINGS[lang].table} ${i}`; sel.appendChild(o);
  }
  const saved = localStorage.getItem('nima.table');
  if(saved) sel.value=saved;
  sel.onchange = ()=> localStorage.setItem('nima.table', sel.value);
}

/* ===== Call waiter ===== */
$('#callBtn').addEventListener('click', ()=>{
  const t = tableSelect.value || 'ØŸ';
  const ar = `ğŸ”” Ø·Ø§ÙˆÙ„Ø© ${t} ØªØ­ØªØ§Ø¬ Ø®Ø¯Ù…Ø©`;
  const en = `ğŸ”” Table ${t} needs service`;
  const text = encodeURIComponent(`${ar} | ${en}`);
  const url = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage?chat_id=${TELEGRAM_CHAT_ID_NEW}&text=${text}`;
  fetch(url).catch(console.error);
  toast(STRINGS[lang].waiter_toast);
});

/* ===== Product Modal logic ===== */
let currentProduct = null;
let currentCat = 'hot';

function isJabana(it){
  const a = (it.ar||''); const e=(it.en||'').toLowerCase();
  return a.includes('Ø¬Ø¨Ù†Ø©') || a.includes('Ø³ÙˆØ¯Ø§Ù†ÙŠØ©') || e.includes('jabana') || e.includes('sudanese');
}
function isWater(it){
  const a=(it.ar||''); const e=(it.en||'').toLowerCase();
  return a.includes('Ù…Ø§Ø¡') || e.includes('water');
}

function updateCustomizationLabels(){
  $('#customTitle').textContent = STRINGS[lang].customize;
  $('#lblLessIce').textContent = STRINGS[lang].less_ice;
  $('#lblGinger').textContent = STRINGS[lang].ginger;
  $('#lblCardamom').textContent = STRINGS[lang].cardamom;
  $('#lblHeavy').textContent = STRINGS[lang].heavy;
  $('#lblLight').textContent = STRINGS[lang].light;
  $('#lblBalanced').textContent = STRINGS[lang].balanced;
  $('#backBtn').textContent = lang==='ar' ? 'Ø±Ø¬ÙˆØ¹' : 'Back';
  $('#addBtn').textContent = lang==='ar' ? 'Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©' : 'Add to Cart';
  document.querySelector('#lblSugarExternal').textContent = STRINGS[lang].sugar_external;
  document.querySelector('#lblSugarNone').textContent = STRINGS[lang].sugar_none;
  document.querySelector('#lblSugarLess').textContent = STRINGS[lang].sugar_less;
  document.querySelector('#lblSugarNormal').textContent = STRINGS[lang].sugar_normal;
  document.querySelector('#lblWaterCold').textContent = STRINGS[lang].water_cold;
  document.querySelector('#lblWaterRoom').textContent = STRINGS[lang].water_room;
}

function openProduct(it, cat){
  currentProduct = it;
  currentCat = cat || 'hot';
  $('#pImg').src = it.img || IMG_DEFAULT;
  $('#pName').textContent = (lang==='ar'?it.ar:it.en);
  $('#pPrice').innerHTML = priceHTML(it.price);
  $('#pCal').textContent = `${it.cal} ${STRINGS[lang].kcal}`;
  $('#pDesc').textContent = it['desc_'+lang] || autoDesc(it);
  $('#pQty').textContent = '1';
  updateCustomizationLabels();

  // reset radios
  document.querySelectorAll('input[name="sugar"]').forEach(r=> r.checked = (r.value==='external'));
  document.querySelectorAll('input[name="waterTemp"]').forEach(r=> r.checked = (r.value==='cold'));
  $('#optLessIce').checked = false;
  $('#optGinger').checked = false;
  $('#optCardamom').checked = false;
  document.querySelectorAll('input[name="strength"]').forEach(r=> r.checked = (r.value==='balanced'));

  // visibility
  const water = isWater(it);
  const jab = isJabana(it);

  document.getElementById('wrapLessIce').style.display = (currentCat==='cold' && !water) ? 'inline-flex' : 'none';
  document.getElementById('sugarGroup').style.display = (currentCat!=='dessert' && !water) ? 'flex' : 'none';
  document.getElementById('waterTempGroup').style.display = water ? 'flex' : 'none';
  document.getElementById('customJabana').style.display = jab ? 'flex' : 'none';
  document.getElementById('strengthGroup').style.display = jab ? 'flex' : 'none';

  document.getElementById('productModal').style.display='flex';
}
function closeProduct(){ document.getElementById('productModal').style.display='none'; }
function incQty(){ let q=parseInt($('#pQty').textContent)||1; $('#pQty').textContent = Math.min(q+1,99); }
function decQty(){ let q=parseInt($('#pQty').textContent)||1; $('#pQty').textContent = Math.max(q-1,1); }

function gatherCustomization(){
  const opts = [];
  // water temp
  if(isWater(currentProduct)){
    const wt = (document.querySelector('input[name="waterTemp"]:checked')||{}).value || 'cold';
    opts.push(wt==='cold' ? STRINGS[lang].water_cold : STRINGS[lang].water_room);
    return opts;
  }
  // sugar
  if (document.getElementById('sugarGroup').style.display!=='none') {
    const sugar = (document.querySelector('input[name="sugar"]:checked')||{}).value || 'external';
    const sugarLabel = sugar==='external'?STRINGS[lang].sugar_external
                      : sugar==='none'?STRINGS[lang].sugar_none
                      : sugar==='less'?STRINGS[lang].sugar_less
                      : STRINGS[lang].sugar_normal;
    opts.push(sugarLabel);
  }
  // ice
  if($('#optLessIce').checked && currentCat==='cold') opts.push(STRINGS[lang].less_ice);
  // jabana
  if(isJabana(currentProduct)){
    if($('#optGinger').checked) opts.push(STRINGS[lang].ginger);
    if($('#optCardamom').checked) opts.push(STRINGS[lang].cardamom);
    const st = (document.querySelector('input[name="strength"]:checked')||{}).value || 'balanced';
    const stLabel = st==='heavy'?STRINGS[lang].heavy: st==='light'?STRINGS[lang].light: STRINGS[lang].balanced;
    opts.push(stLabel);
  }
  return opts;
}

function addCurrentToCart(){
  const q = parseInt($('#pQty').textContent)||1;
  const options = gatherCustomization();
  addToCart(currentProduct, q, options);
  closeProduct();
  toast(STRINGS[lang].added);
}

/* ===== Cart logic ===== */
function openCart(){ renderCart(); document.getElementById('cartSheet').style.display='flex'; }
function closeCart(){ document.getElementById('cartSheet').style.display='none'; }
document.getElementById('cartFab').addEventListener('click', openCart);

function addToCart(it, qty=1, options=[]){
  const key = (it.en||it.ar) + '|' + (options.join(',') || '-');
  const idx = cart.findIndex(x=>x.key===key);
  if(idx>-1){ cart[idx].qty += qty; }
  else{
    cart.push({ key, name_ar:it.ar, name_en:it.en, price:it.price, cal:it.cal, img:it.img||IMG_DEFAULT, qty, options });
  }
  saveCart(); updateCartBadge();
}
function changeQty(key, delta){
  const i = cart.findIndex(x=>x.key===key);
  if(i>-1){
    cart[i].qty += delta;
    if(cart[i].qty<=0) cart.splice(i,1);
    saveCart(); renderCart(); updateCartBadge();
  }
}
function clearCart(){ cart = []; saveCart(); renderCart(); updateCartBadge(); }

function renderCart(){
  const wrap = $('#cartItems');
  wrap.innerHTML = '';
  if(cart.length===0){
    $('#emptyText').style.display='block';
  } else {
    $('#emptyText').style.display='none';
    cart.forEach(it=>{
      const name = (lang==='ar'?it.name_ar:it.name_en);
      const optsText = (it.options && it.options.length) ? ' â€¢ ' + it.options.join('Ø› ') : '';
      wrap.insertAdjacentHTML('beforeend', `
        <div class="cart-item">
          <div class="thumb"><img src="${it.img}" alt="${name}"></div>
          <div>
            <div class="title">${name}</div>
            <div class="meta">${it.cal} ${STRINGS[lang].kcal}${optsText}</div>
            <div class="price" style="margin-top:4px">
              ${priceHTML(it.price)}
            </div>
          </div>
          <div class="qty">
            <button onclick="changeQty('${it.key.replace(/'/g,"&#39;")}',-1)">âˆ’</button>
            <span style="min-width:24px;text-align:center">${it.qty}</span>
            <button onclick="changeQty('${it.key.replace(/'/g,"&#39;")}',+1)">+</button>
          </div>
        </div>
      `);
    });
  }
  $('#cartTotal').innerHTML = priceHTML(cartTotal());
}

/* ===== Send order to Telegram ===== */
function sendOrder(){
  if(cart.length===0){ toast(lang==='ar'?'Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©':'Cart is empty'); return; }
  const tableId = document.getElementById('tableCart').value || document.getElementById('table').value || '?';
  const lines = cart.map(it=>{
    const n = (lang==='ar'?it.name_ar:it.name_en);
    const opt = (it.options && it.options.length) ? ` (${it.options.join(', ')})` : '';
    const line = `${n}${opt} x${it.qty} = ${it.qty*it.price} SAR`;
    return line;
  });
  const total = cartTotal();
  const header_ar = `ğŸ§¾ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ â€” Ø·Ø§ÙˆÙ„Ø© ${tableId}`;
  const header_en = `ğŸ§¾ New Order â€” Table ${tableId}`;
  const body = lines.map(encodeURIComponent).join('%0A');
  const footer = `%0Aâ€” Total: ${total} SAR`;
  const text = encodeURIComponent(`${header_ar} | ${header_en}`) + `%0A` + body + footer;

  const url = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage?chat_id=${TELEGRAM_CHAT_ID_NEW}&text=${text}`;
  fetch(url)
    .then(()=> { toast(lang==='ar'?'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­ âœ…':'Order sent âœ…'); clearCart(); closeCart(); })
    .catch(()=> { toast(lang==='ar'?'ØªØ¹Ø°Ù‘Ø± Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ âŒ':'Failed to send âŒ'); });
}

/* ===== Toast ===== */
function toast(msg){
  const t = document.createElement('div');
  t.textContent = msg;
  t.style.position='fixed'; t.style.bottom='86px'; t.style.left='50%'; t.style.transform='translateX(-50%)';
  t.style.padding='12px 20px'; t.style.borderRadius='12px'; t.style.boxShadow='0 4px 12px rgba(0,0,0,0.2)';
  t.style.zIndex='400'; t.style.opacity='0'; t.style.transition='opacity .3s ease';
  t.style.background = document.body.classList.contains('dark') ? 'var(--brand-dark)' : 'var(--brand)';
  t.style.color = '#fff';
  document.body.appendChild(t);
  setTimeout(()=> t.style.opacity='1', 20);
  setTimeout(()=> { t.style.opacity='0'; setTimeout(()=>t.remove(), 300); }, 2500);
}

/* ===== Init ===== */
function updateLangBtn(){ document.getElementById('langBtn').textContent = (lang==='ar') ? 'English' : 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©'; }
function init(){
  renderAll(); updateLangBtn(); updateCartBadge();
}
init();
  </script>
</body>
</html>
